#set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# Fast navigation in copy mode
bind -T copy-mode-vi C-k send-keys -X -N 4 cursor-up
bind -T copy-mode-vi C-j send-keys -X -N 4 cursor-down
bind -T copy-mode-vi C-h send-keys -X previous-word
bind -T copy-mode-vi C-l send-keys -X next-word-end

# vim-like pane switching
bind k select-pane -U
bind j select-pane -D
bind h select-pane -L
bind l select-pane -R

# repeatable window navigation (Ctrl-a n n n to advance multiple windows)
set-option -g repeat-time 800
bind-key -r n next-window
bind-key -r p previous-window

# ERTYUIO keys for windows 10+ (extends default 0-9 bindings)
bind-key e select-window -t :10
bind-key r select-window -t :11
bind-key t select-window -t :12
bind-key y select-window -t :13
bind-key u select-window -t :14
bind-key i select-window -t :15
bind-key o select-window -t :16

# show current working directory (useful when running TUI apps)
bind-key P display-message "#{pane_current_path}"

# ============================================
# Floating Popups (Gruvbox-styled, rounded borders)
# ============================================
# Global popup defaults
set -g popup-border-lines rounded
set -g popup-border-style 'fg=#504945'
set -g popup-style 'bg=#282828'

# Persistent scratch terminal toggle (Alt+g, no prefix for speed)
# State survives dismissal â€” running processes keep going
bind -n M-g if-shell -F '#{==:#{session_name},scratch}' \
    { detach-client } \
    { display-popup -d "#{pane_current_path}" -xC -yC -w 80% -h 80% \
        -T ' scratch ' \
        -E 'tmux attach-session -t scratch || tmux new-session -s scratch' }

# Lazygit popup (prefix+g)
bind-key g display-popup -E -w 90% -h 90% -d "#{pane_current_path}" \
    -T ' lazygit ' lazygit

# k9s popup (prefix+K)
bind-key K display-popup -E -w 95% -h 95% \
    -T ' k9s ' k9s

# Hide scratch session from session switcher (prefix+s)
bind-key s choose-tree -Zs -f '#{?#{m:scratch,#{session_name}},0,1}'

# Disable resurrect manual save (continuum auto-saves every 5min)
unbind-key C-s

# ============================================
# Idle-Fade Window Colors (8-color Gruvbox scale)
# ============================================
# Color windows based on background activity using pipe-pane
# Thresholds: <10m bright-green, 10-30m green, 30-60m aqua, 1-2h yellow,
#             2-4h orange, 4-8h red, 8-24h purple, >24h gray
# Bell override: magenta+bold

# Activity monitoring (disabled to avoid status bar noise)
set -g monitor-activity off
set -g visual-activity off

# Bell configuration - sound via tmux hook (bypasses Alacritty)
set -g monitor-bell on
set -g visual-bell off
set -g bell-action current
set-hook -g alert-bell 'run-shell "paplay /run/current-system/sw/share/sounds/freedesktop/stereo/message.oga &"'

# Pipe-pane activity tracking (bypasses bell system entirely)
# - Switch: stop pipe on focused window, start on all background windows
# - Window-linked: start pipe on new window if not current
set-hook -g after-select-window 'run-shell -b "~/.config/tmux/pipe-activity.sh switch"'
set-hook -g window-linked 'run-shell -b "~/.config/tmux/pipe-activity.sh switch"'
set-hook -g session-created 'run-shell -b "~/.config/tmux/pipe-activity.sh init"'

# Status bar refresh rate (2s - balance between responsiveness and CPU)
set -g status-interval 2

# Window status format - idle windows call script for color calculation
# Args: window_index, window_name, window_flags, window_id, bell_flag
set -g window-status-format '#(~/.config/tmux/idle-color.sh "#{window_index}" "#{window_name}" "#{window_flags}" "#{window_id}" "#{window_bell_flag}")'
set -g window-status-current-format '#[fg=#ebdbb2,bg=#504945,bold] #I:#W #[default]'

# ============================================
# Custom Gruvbox-style Theme
# ============================================
set -g status-style 'bg=#282828,fg=#ebdbb2'
set -g window-status-style 'bg=default'
set -g window-status-activity-style 'bg=default'
# Mode indicator: prefix=yellow, normal=cyan
set -g status-left '#{?client_prefix,#[bg=#d79921],#[bg=#83a598]}#[fg=#282828,bold] #S #[default] '
set -g status-right '#[fg=#ebdbb2] %H:%M #[fg=#282828,bg=#83a598] #H '
set -g status-left-length 30
set -g status-right-length 50

# Pane borders
set -g pane-border-style 'fg=#504945'
set -g pane-active-border-style 'fg=#83a598'

# Message styling
set -g message-style 'bg=#282828,fg=#ebdbb2'

